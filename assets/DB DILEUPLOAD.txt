DROP TABLE ELOCAL.FILEUPLOAD CASCADE CONSTRAINTS;

CREATE TABLE ELOCAL.FILEUPLOAD
(
  ID          VARCHAR2(255 BYTE),
  DOCTYPE     VARCHAR2(255 BYTE)                NOT NULL,
  DOCID       VARCHAR2(255 BYTE)                NOT NULL,
  FILELOC     VARCHAR2(255 BYTE)                NOT NULL,
  FILENAME    VARCHAR2(255 BYTE)                NOT NULL,
  FILESIZE    NUMBER,
  UPDATEDATE  DATE,
  UPDATEBY    VARCHAR2(255 BYTE)
)
TABLESPACE USERS
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
LOGGING 
NOCOMPRESS 
NOCACHE
MONITORING;


CREATE OR REPLACE TRIGGER ELOCAL.TRIGGER_FILEUPLOAD
BEFORE INSERT 
ON ELOCAL.FILEUPLOAD
REFERENCING NEW AS NEW OLD AS OLD
FOR EACH ROW
DECLARE

        vSEQ varchar2(3);

BEGIN
    
    SELECT TO_CHAR(COUNT(*)+1) INTO vSEQ
    FROM FILEUPLOAD 
    WHERE DOCTYPE = :NEW.DOCTYPE AND DOCID = :NEW.DOCID;

       :NEW.ID := :NEW.DOCTYPE||'.'||:NEW.DOCID||'.'||vSEQ; 
   
END;
/


CREATE OR REPLACE TRIGGER ELOCAL.TRIGGER_UPLOADFILE
    BEFORE INSERT OR UPDATE
    ON ELOCAL.FILEUPLOAD
    REFERENCING NEW AS NEW OLD AS OLD
    FOR EACH ROW
DECLARE
    
BEGIN
    :NEW.updatedate := SYSDATE;

END;
/
